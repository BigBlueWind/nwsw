#!/usr/bin/perl
# generate msg name strings correcponsing to msgIds
# Manu. 21July09
$file=shift;
if (!defined($file))
{
  print "usage: $0 msg_ids.h";
  exit;
}
open(IN, "<$file") || die "cannot open $file";

my $now = localtime time;
print "/* generated by $0 on $now */\n";
print "#include \"basic_types.h\"\n";
# include msg_names.h to ensure that prototype matchees with generated stuff */
print "#include \"msg_names.h\"\n"; 
print "#include \"msg_ids.h\"\n";
print "typedef struct s_IdName {\n  UINT32 id;\n  const String50 name;\n} IdName;\n";
print "const IdName c_msgNameTab[] =\n";
print "{\n";

while (<IN>)
{
  if (/(MSG_.*),/)
  {
    $msgId = $1;
    $msgId =~ s/[\s]//g;
    printf "  {$msgId, %30s},\n", "\"$msgId\"";
  }
}

printf "  {0, %30s}\n", "\"\"";
print "};\n";
close IN;

print "\n";
print "inline const UINT8* getMsgName(IN MsgId msgId)\n";
print "{\n";
print "  if( msgId > MSG_ID_MAX )\n";
print "  {\n";
print "    return \"INVALID MESSAGE\";\n";
print "  }\n";
print "  else\n";
print "  {\n";
print "    return &c_msgNameTab[msgId].name[0];\n";
print "  }\n";
print "}\n\n";
